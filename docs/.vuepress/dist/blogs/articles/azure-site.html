<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft Azure For Spoiled People 3 - Migrate a database | Jen Looper - Developer Advocate based in Boston, MA</title>
    <meta name="description" content="Jen Looper, blog, articles, speaking, writing, development, web, mobile">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.480b0287.css" as="style"><link rel="preload" href="/assets/js/app.9d57326b.js" as="script"><link rel="preload" href="/assets/js/6.a14e076f.js" as="script"><link rel="prefetch" href="/assets/js/10.040c2854.js"><link rel="prefetch" href="/assets/js/11.b7c4915f.js"><link rel="prefetch" href="/assets/js/2.55cda6ef.js"><link rel="prefetch" href="/assets/js/3.bb0ac3c0.js"><link rel="prefetch" href="/assets/js/4.977000ca.js"><link rel="prefetch" href="/assets/js/5.b4dc4803.js"><link rel="prefetch" href="/assets/js/7.97a76a57.js"><link rel="prefetch" href="/assets/js/8.f0704b9b.js"><link rel="prefetch" href="/assets/js/9.134e6c49.js">
    <link rel="stylesheet" href="/assets/css/0.styles.480b0287.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="wrapper"><div class="markdown-body font-serif bg-white m-2 sm:m-3 md:m-6 lg:m-12 text-lg rounded-lg shadow-lg"><nav class="nav rounded-t flex items-center justify-between flex-wrap text-right pr-0 lg:pr-5 md:pr-3 sm:pr-0 border-b"><a href="/" class="w-1/2 md:w-1/3 cursor-pointer block m-1 lg:m-4 md:m-2 sm:m-1 router-link-active"><img src="/images/sig.png"></a> <div class="lg:hidden"><button class="flex m-5 px-3 py-2 border rounded border-white hover:text-orange hover:border-orange"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="fill-current h-3 w-3"><title>Menu</title> <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div> <div class="w-full block justify-end lg:flex lg:w-auto"><div class="nav-text text-med lg:flex-grow"><span><span class="lg:inline-block md:hidden sm:hidden hidden"><a href="/blogs/articles/" class="text-sans mr-10 lg:mt-0 no-underline hover:text-yellow-600 hover:underline uppercase router-link-active">
            Articles
            <span class="arrow"></span></a></span></span><span><span class="lg:inline-block md:hidden sm:hidden hidden"><a href="/blogs/about/" class="text-sans mr-10 lg:mt-0 no-underline hover:text-yellow-600 hover:underline uppercase">
            About
            <span class="arrow"></span></a></span></span><span><span class="lg:inline-block md:hidden sm:hidden hidden"><a href="/blogs/contact/" class="text-sans mr-10 lg:mt-0 no-underline hover:text-yellow-600 hover:underline uppercase">
            Contact
            <span class="arrow"></span></a></span></span><span><span class="lg:inline-block md:hidden sm:hidden hidden"><a href="/blogs/speaking/" class="text-sans mr-10 lg:mt-0 no-underline hover:text-yellow-600 hover:underline uppercase">
            Speaking
            <span class="arrow"></span></a></span></span></div></div></nav> <div class="markdown-body article"><h1 class="text-3xl pb-5 pt-5 ml-5 text-sans">Microsoft Azure For Spoiled People 3 - Migrate a database</h1> <div class="text-gray-800 p-5"><div class="content__default"><p>So far in this series, I've talked about how to get set up on Azure as a web app with hosting on <code>azurewebsites.net</code> and how to set up continuous integration using Azure pipelines. If you've been following along, you'll know by now how to scaffold a Vue web site and have it solidly hosted on Azure. Check parts 1 and 2 of this series to learn more.</p> <p><img src="/images/41/cocktail1.png" alt="cocktails!"></p> <p>Now we return to the premise of the series, which is the idea that, at some point, you might need to move off of services such as Firebase, with its intuitive real-time database service, and onto a service like Microsoft Azure. But so far, I haven't really talked about the database part of the equation.</p> <h2 id="get-ready-friends-because-it-s-database-time"><a href="#get-ready-friends-because-it-s-database-time" class="header-anchor">#</a> Get ready, friends, because it's DATABASE TIME!</h2> <p>The web site that I have wanted to build makes use of the same dataset that I created for my MixoLogy demo app. Learn more about that project <a href="https://www.youtube.com/watch?v=SgBDEydZb4A" target="_blank" rel="noopener noreferrer">in this video<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. It involved repurposing data from the <a href="https://mrbostondrinks.com/about" target="_blank" rel="noopener noreferrer">Old Mr. Boston Bartender's Guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>*, a classic book of over 1000 cocktails originally published in 1935 (and now reprinted for your enjoyment after having undergone many revisions).</p> <p>After a lot of data cleaning, my dataset contains 990 recipes which you can <a href="https://www.kaggle.com/jenlooper/analyzing-mr-boston-dataset" target="_blank" rel="noopener noreferrer">peruse on Kaggle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, for data science purposes. These recipes also reside in Firebase, and are even now used in my MixoLogy mobile app: click on an image of a bottle and get recipes that use that particular spirit, among other things.</p> <p>For my new website, built for this series, I wanted to create a web site reflecting something Azure-colored, so I decided to create a listing of the cocktails that would naturally be colored blue, due to the presence of blue curacao liqueur in the recipe. In essence, I need:</p> <ul><li>to import my dataset into one of Azure's database offerings</li> <li>to use that dataset in my Azure-Cocktails Vue app</li> <li>to build a nice UI around the experience</li></ul> <p>So, back to <a href="https://ms.portal.azure.com?WT.mc_id=jenloopercom-blog-jelooper" target="_blank" rel="noopener noreferrer">Azure Portal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>! Originally, I had thought I'd need to jump to Cosmos DB, but my database needs are very minimal for this app; just one collection,a simple data structure, and a very basic use case. So Cosmos DB is a little too much for this project.</p> <blockquote><p>You might want to use <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/use-cases?WT.mc_id=jenloopercom-blog-jelooper" target="_blank" rel="noopener noreferrer">Cosmos DB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for databases that require global distribution and that need to scale. For my little app, it wasn't necessary to have such a robust solution.</p></blockquote> <p>Instead, after consulting with my colleagues Simona Cotin and Suz Hinton, I decided to use Azure Tables, a part of Azure Storage, to store my basic cocktail data.</p> <p><img src="/images/41/cocktail2.png" alt="cocktails!"></p> <h2 id="step-1-export-your-firebase-data"><a href="#step-1-export-your-firebase-data" class="header-anchor">#</a> Step 1: Export your Firebase data</h2> <p>The first step for me was to download my data from Firebase and upload it to Azure. Downloading is easy enough; find your database in the Firebase console and export it as JSON to your local.</p> <p><img src="/images/41/firebase.png" alt="firebase"></p> <p>Next, you're going to want to convert this data to a .csv format. Do it using a tool such as this one: <a href="json-csv.com">json to csv</a>.</p> <p>To upload this data to Azure Table Storage, first visit the Azure Portal and create a database. Click the <code>+</code> at the top left to create a resource. It will be a Storage Account, and can be a <code>general purpose v1</code> storage account for <code>Locally-redundant storage (LRS)</code>.</p> <p><img src="/images/41/azure-storage-account.png" alt="azure storage"></p> <p>Once the deployment of this account is complete, you will see several elements of your storage account listed. The one of interest to us is the Table Storage. Here's where you will create a table to store your exported data. Click on the 'Tables' link:</p> <p><img src="/images/41/azure-storage.png" alt="azure storage"></p> <p>At this point, you want to find some way to import the data. But hey, there's no link or any easy way to do it via the web portal! Oh noes!</p> <p>Thanks to Suz's super secret tip, there's a 'backdoor' to do this: the Azure Storage Explorer desktop tool.</p> <p><img src="/images/41/storage-explorer.png" alt="azure storage tool"></p> <h2 id="step-2-upload-your-data-to-azure-storage"><a href="#step-2-upload-your-data-to-azure-storage" class="header-anchor">#</a> Step 2: Upload your data to Azure Storage</h2> <p>Go to the <a href="https://azure.microsoft.com/en-us/features/storage-explorer?WT.mc_id=jenloopercom-blog-jelooper/" target="_blank" rel="noopener noreferrer">Storage Explorer web site<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and download this free tool. After it's installed, login using your Azure credentials.</p> <p>Now, when you fire up the tool, you can navigate to your storage account's tables and upload your data from .csv. Use the toolbar at the top of the table to import.</p> <p><img src="/images/41/desktop-explorer.png" alt="azure storage explorer tool"></p> <blockquote><p>Note, Table Storage is picky about column names, and you may need to rename yours in pascal-case or camel-case.</p></blockquote> <p>If all goes well, you should have your data safely in an Azure Table! Now you can start using it in your app.</p> <p><img src="/images/41/cocktail3.png" alt="cocktails!"></p> <h2 id="connect-your-app-to-azure-tables"><a href="#connect-your-app-to-azure-tables" class="header-anchor">#</a> Connect your app to Azure Tables</h2> <p>To connect your Vue app to the Storage service you created in Azure, you need to use the <a href="https://github.com/Azure/azure-storage-node?WT.mc_id=jenloopercom-blog-jelooper" target="_blank" rel="noopener noreferrer">Azure-Storage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> npm package, which is Azure's Storage SDK for Node.js. Install it in your app (<code>npm i azure-storage</code>). You'll need it when you query the database.</p> <p>As is normal in an app that connects to the cloud, a connection string is needed to make the handshake between a service and an app. Find the right connection string in the Azure portal under the Storage Account's 'Access Keys' section. I added mine to a <code>config.js</code> file that I placed in the app root:</p> <div class="language- extra-class"><pre class="language-text"><code>export default {
	DB_KEY:
		'DefaultEndpointsProtocol=https;AccountName=azurecocktails921b;AccountKey=blablabla==;EndpointSuffix=core.windows.net',
};
</code></pre></div><p>Once the key is in place, you can reference <code>DB_KEY</code> in the app.</p> <h2 id="query-the-data"><a href="#query-the-data" class="header-anchor">#</a> Query the data</h2> <p>The moment has arrived to use your data, finally! In this app, I want to show only cocktails that are blue in color because, you know, Azure. I figure, if the recipe has any dosage of blue curaçao, it will be at least a little blue. So I created a Vuex store where all my database functions will reside.</p> <p>To fetch the list of cocktails, I added a query:</p> <div class="language- extra-class"><pre class="language-text"><code>	fetchCocktails({ commit }) {
		var azure = require('azure-storage');
		var tableService = azure.createTableService(config.DB_KEY);
		var query = new azure.TableQuery()
			.top(100)
			.where('ingredient1 eq ?', 'Blue curacao')
			.or('ingredient2 eq ?', 'Blue curacao')
			.or('ingredient3 eq ?', 'Blue curacao')
			.or('ingredient4 eq ?', 'Blue curacao')
			.or('ingredient5 eq ?', 'Blue curacao')
			.or('ingredient6 eq ?', 'Blue curacao');

		tableService.queryEntities('cocktails', query, null, function(error, result, response) {
			if (!error) {
				commit('setCocktails', response.body.value);
			} else {
				//throw error
				alert('Oh noes! No cocktails found.');
			}
		});
	},
</code></pre></div><p>In this query, there are several things going on:</p> <ul><li>use the azure-storage npm package</li> <li>create a reference to the storage service from that package, invoking the <code>db_key</code> in the config file</li> <li>create a new query with several conditionals</li> <li>call the query on the service</li> <li>commit the results to the Vuex store where it can be reused</li></ul> <p>Now, you can get the filtered list of cocktails in the <code>created()</code> lifecycle hook in your Home.vue component, storing the returned data in a computed property for use in creating the recipe cards:</p> <div class="language- extra-class"><pre class="language-text"><code> computed: {
    ...mapState([&quot;cocktails&quot;])
},

created() {
    this.$store.dispatch(&quot;fetchCocktails&quot;);
}
</code></pre></div><p>And ... voila! Now you have data you can view in your app ... or at least you should.</p> <h2 id="fix-cors"><a href="#fix-cors" class="header-anchor">#</a> Fix CORS</h2> <p>Beware! You might be unpleasantly surprised to see that your data isn't yet showing up! That's because you may have run into a CORS issue. Go back into your Storage account in the portal and ensure that CORS is set properly, giving access to your web site via the appropriate headers. Learn more about <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/Cross-Origin-Resource-Sharing--CORS--Support-for-the-Azure-Storage-Services?WT.mc_id=jenloopercom-blog-jelooper" target="_blank" rel="noopener noreferrer">CORS in the docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Once CORS is fixed, you should see your app running locally and also you can post it up to Azure following the instructions in the first two articles in this series.</p> <p><img src="/images/41/azure-cocktails-ws.png" alt="cocktails!"></p> <h2 id="cheers"><a href="#cheers" class="header-anchor">#</a> Cheers!</h2> <p>If you like blue curaçao, you're in luck! I've built a nice-looking, simple database-driven web site for your summer enjoyment. By the way, I hand drew all the cocktails, based on their descriptions, using Procreate and an Apple Pencil.</p> <p><img src="/images/41/lady_cocktail.png" alt="cheers!"></p> <p>In this post, I discussed how to get a very basic database set up to query in your Vue app. In my next post, I'll talk more about how to use it more like a Firebase database, using realtime functionality to enhance the app's UI. Stay tuned!</p> <p>*The Mr. Boston brand name is now the intellectual property of Sazerac, who retains the rights to the brand but graciously allows for <a href="http://www.sazerac.com/SazeracTermsOfUse.html" target="_blank" rel="noopener noreferrer">noncommercial use<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> of the content.</p></div></div></div> <footer class="footer rounded-b sticky pin-bottom p-6"><div class="text-sans w-full text-base lg:text-xl md:text-sm sm:text-sm block flex-grow flex justify-center items-center w-auto">
    © 2019 Ladeez First Media
    <a href="http://github.com/jlooper" class="m-2 no-underline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current w-5 h-5"><title>GitHub</title> <path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg></a> <a href="http://twitter.com/jenlooper" class="m-2 no-underline text-gray-800"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current w-5 h-5"><title>Twitter</title> <path d="M6.29 18.25c7.55 0 11.67-6.25 11.67-11.67v-.53c.8-.59 1.49-1.3 2.04-2.13-.75.33-1.54.55-2.36.65a4.12 4.12 0 0 0 1.8-2.27c-.8.48-1.68.81-2.6 1a4.1 4.1 0 0 0-7 3.74 11.65 11.65 0 0 1-8.45-4.3 4.1 4.1 0 0 0 1.27 5.49C2.01 8.2 1.37 8.03.8 7.7v.05a4.1 4.1 0 0 0 3.3 4.03 4.1 4.1 0 0 1-1.86.07 4.1 4.1 0 0 0 3.83 2.85A8.23 8.23 0 0 1 0 16.4a11.62 11.62 0 0 0 6.29 1.84"></path></svg></a></div></footer></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9d57326b.js" defer></script><script src="/assets/js/6.a14e076f.js" defer></script>
  </body>
</html>
